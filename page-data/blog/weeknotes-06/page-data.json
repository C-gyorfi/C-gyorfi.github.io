{"componentChunkName":"component---node-modules-gatsby-theme-simple-blog-src-templates-post-js","path":"/blog/weeknotes-06/","result":{"data":{"blogPost":{"id":"efc58ed9-3a71-58ee-9e0c-75276f153e17","title":"Weeknotes 6 - Taking notes, performance testing and deleting a versioned S3 bucket","parent":{"timeToRead":1},"date":"October 09, 2021","author":"Csaba Gyõrfi","slug":"/blog/weeknotes-06/","excerpt":"Taking Notes It is \"a bit meta\" writing my Weeknotes about how I take notes. This week I started using  Notion . I used to keep my notes all…","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"type\": \"post\",\n  \"title\": \"Weeknotes 6 - Taking notes, performance testing and deleting a versioned S3 bucket\",\n  \"date\": \"2021-10-09T00:00:00.000Z\",\n  \"draft\": false,\n  \"media\": \"./bucket.jpg\",\n  \"author\": \"Csaba Gyõrfi\",\n  \"tags\": [\"Weeknotes\", \"Notion\", \"AWS\", \"S3\", \"Deleting a versioning-enabled bucket\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h2\", {\n    \"id\": \"taking-notes\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#taking-notes\",\n    \"aria-label\": \"taking notes permalink\",\n    \"className\": \"anchor-header before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"height\": \"20\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"20\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentColor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Taking Notes\"), mdx(\"p\", null, \"It is \\u201Ca bit meta\\u201D writing my Weeknotes about how I take notes. This week I started using \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.notion.so/\"\n  }, \"Notion\"), \". I used to keep my notes all over the places, for example, Google Drive, Markdown files/GitHub or just in text files on my laptop, which caused a massive headache when organising my knowledge. I had not started using Notion earlier because it is undoubtedly heavier than a whatever text editor, but of course. After all, it is a fully-fledged productivity tool. So far, I\\u2019m using it as a notebook, but maybe I will migrate my \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://trello.com/\"\n  }, \"Trello\"), \" boards one day. By the way, I often use Trello to manage my projects and life in general.\"), mdx(\"h2\", {\n    \"id\": \"performance-testing\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#performance-testing\",\n    \"aria-label\": \"performance testing permalink\",\n    \"className\": \"anchor-header before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"height\": \"20\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"20\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentColor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Performance testing\"), mdx(\"p\", null, \"I spent most of my week automating performance tests against a \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://en.wikipedia.org/wiki/RADIUS\"\n  }, \"RADIUS server\"), \". We needed to deploy numerous EC2 instances that played the clients\\u2019 role in sending authentication requests to the server. For successful authentication, the clients must have signed certificates, configuration files and a script that repeatedly fires requests. We uploaded these files into a configuration S3 bucket where the EC2 instances could pull these files while booting. As good default practice, we used a versioning-enabled bucket. When we tried to tear down the infrastructure, I had to relearn that deleting a versioned S3 bucket is not that straightforward. I\\u2019ve created a script that I can pull out of my pocket next time.\"), mdx(\"h3\", {\n    \"id\": \"deleting-the-versioning-enabled-s3-bucket\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#deleting-the-versioning-enabled-s3-bucket\",\n    \"aria-label\": \"deleting the versioning enabled s3 bucket permalink\",\n    \"className\": \"anchor-header before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"height\": \"20\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"20\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentColor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Deleting the versioning-enabled S3 bucket\"), mdx(\"p\", null, \"You cannot delete an S3 bucket unless it is empty. The reason for versioning a bucket is to eliminate the chance of losing valuable data. Therefore deleting from a versioned bucket has a bit of complexity: S3 creates a delete marker when deleting from the bucket, which becomes the new version of the object instead of simply removing the thing. Therefore we need to run three API calls for the delete operation. First, you need to delete all versions of the objects in the bucket:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"bash\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-bash\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"aws s3api delete-objects --bucket \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"your-bucket-name\\\"\"), \" --delete \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token variable\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token variable\"\n  }, \"$(\"), \"aws s3api list-object-versions --bucket \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token string\"\n  }, \"\\\"your-bucket-name\\\"\"), \" --output\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \"=\"), \"json --query\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \"=\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token string\"\n  }, \"'{Objects: Versions[].{Key:Key,VersionId:VersionId}}'\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token variable\"\n  }, \")\")), \"\\\"\")))), mdx(\"p\", null, \"Then you need to delete each delete marker:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"bash\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-bash\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"aws s3api delete-objects --bucket \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"your-bucket-name\\\"\"), \" --delete \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token variable\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token variable\"\n  }, \"$(\"), \"aws s3api list-object-versions --bucket \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token string\"\n  }, \"\\\"your-bucket-name\\\"\"), \" --output\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \"=\"), \"json --query\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \"=\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token string\"\n  }, \"'{Objects: DeleteMarkers[].{Key:Key,VersionId:VersionId}}'\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token variable\"\n  }, \")\")), \"\\\"\")))), mdx(\"p\", null, \"And finally, you can destroy the bucket:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"text\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-text\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-text\"\n  }, \"aws s3api delete-bucket --bucket \\\"your-bucket-name\\\"\"))), mdx(\"p\", null, \"To sum this up in a single script, you can create a \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"delete_bucket.sh\"), \" file with the following:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"bash\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-bash\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token shebang important\"\n  }, \"#!/bin/bash\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token assign-left variable\"\n  }, \"bucket_name\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token variable\"\n  }, \"$1\"), \"\\n\\naws s3api delete-objects --bucket \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token variable\"\n  }, \"$bucket_name\"), \" --delete \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token variable\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token variable\"\n  }, \"$(\"), \"aws s3api list-object-versions --bucket $bucket_name --output\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \"=\"), \"json --query\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \"=\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token string\"\n  }, \"'{Objects: Versions[].{Key:Key,VersionId:VersionId}}'\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token variable\"\n  }, \")\")), \"\\\"\"), \"\\n\\naws s3api delete-objects --bucket \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token variable\"\n  }, \"$bucket_name\"), \" --delete \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token variable\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token variable\"\n  }, \"$(\"), \"aws s3api list-object-versions --bucket $bucket_name --output\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \"=\"), \"json --query\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \"=\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token string\"\n  }, \"'{Objects: DeleteMarkers[].{Key:Key,VersionId:VersionId}}'\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token variable\"\n  }, \")\")), \"\\\"\"), \"\\n\\naws s3api delete-bucket --bucket \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token variable\"\n  }, \"$bucket_name\")))), mdx(\"p\", null, \"Run the script using:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"bash\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-bash\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"bash\"), \" delete_bucket.sh \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"your-bucket-name\\\"\")))), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Be aware this will wipe the bucket with all its data, despite the versioning, so use it on your responsibility!\")));\n}\n;\nMDXContent.isMDXComponent = true;","tags":["Weeknotes","Notion","AWS","S3","Deleting a versioning-enabled bucket"],"media":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAQC/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAFmbWJWiH//xAAbEAABBAMAAAAAAAAAAAAAAAAAAQISMQMQEf/aAAgBAQABBQJmTjaJoJUtf//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/AVf/xAAZEAADAAMAAAAAAAAAAAAAAAAAATEQESH/2gAIAQEABj8Ca3UcJmn/xAAbEAEBAQACAwAAAAAAAAAAAAABEQAhMUFxof/aAAgBAQABPyE6/BO5jw5eVWeN8tSR96Of/9oADAMBAAIAAwAAABBfL//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABURAQEAAAAAAAAAAAAAAAAAABAx/9oACAECAQE/EKP/xAAdEAEBAAIBBQAAAAAAAAAAAAABEQAhMUFRYYHR/9oACAEBAAE/EPOhuiyOMGdFOH1muQATQx1gTgZdAhdO+vmXrW3P/9k=","aspectRatio":1.4970059880239521,"src":"/static/d8b46458cbb08285fb715553c2cca0d6/a7715/bucket.jpg","srcSet":"/static/d8b46458cbb08285fb715553c2cca0d6/8f7df/bucket.jpg 250w,\n/static/d8b46458cbb08285fb715553c2cca0d6/0f3a1/bucket.jpg 500w,\n/static/d8b46458cbb08285fb715553c2cca0d6/a7715/bucket.jpg 1000w,\n/static/d8b46458cbb08285fb715553c2cca0d6/37d86/bucket.jpg 1500w,\n/static/d8b46458cbb08285fb715553c2cca0d6/a41d1/bucket.jpg 2000w,\n/static/d8b46458cbb08285fb715553c2cca0d6/c57b6/bucket.jpg 4272w","sizes":"(max-width: 1000px) 100vw, 1000px"}}}}},"pageContext":{"id":"efc58ed9-3a71-58ee-9e0c-75276f153e17","excerpt":"Taking Notes It is \"a bit meta\" writing my Weeknotes about how I take notes. This week I started using  Notion . I used to keep my notes all…","author":"Csaba Gyõrfi","slug":"/blog/weeknotes-06/","title":"Weeknotes 6 - Taking notes, performance testing and deleting a versioned S3 bucket","tags":["Weeknotes","Notion","AWS","S3","Deleting a versioning-enabled bucket"],"parent":{"timeToRead":1},"date":"October 09, 2021","siteURL":"https://c-gyorfi.github.io","previous":{"node":{"id":"8c8f4c54-80ad-5746-b175-9b1512db408e","excerpt":"It has been a while since I passed the  AWS Certified Developer Associate exam , but I took a longer holiday, \nso I haven't had the chance…","author":"Csaba Gyõrfi","slug":"/blog/aws-certified-developer/","title":"I've become an AWS certified developer, this is how I've done it.","tags":["aws certified developer","AWS","calculating RCU and WCU","exam tips"],"parent":{"timeToRead":3},"date":"September 26, 2021"}},"next":null,"themeConfig":{"loadMorePosts":false,"showNavLinks":true,"themeSwitcher":true,"postsPerPage":10,"postsIncrementBy":5},"locale":"en","tagsPath":"/tags"}},"staticQueryHashes":["3754304596","63159454"]}